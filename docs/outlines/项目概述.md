# 跨物种抗体-抗原结构数据集构建工具概览

## 项目目标
本项目自动化地从 SAbDab 与 PDB 下载抗体-抗原复合物，筛选出人源抗原并找到对应的小鼠同源物，随后下载结构并将小鼠抗原对齐到人源抗原的位置，最终生成可直接用于计算生物学与机器学习的数据三元组。

## 核心流程
1. **数据抓取**：下载 SAbDab 汇总文件，过滤出蛋白抗原、分辨率达标的人源复合物。
2. **同源映射**：调用 UniProt/Ensembl 接口查找小鼠同源抗原，记录序列同一性。
3. **结构获取**：根据 PDB 号下载人源复合物结构与小鼠抗原结构（PDB/mmCIF）。
4. **结构对齐**：默认用 PyMOL 进行序列驱动的结构比对；若不可用则退化为 Biopython。
5. **结果产出**：在 `output/DP_*` 中生成抗体、人源抗原、小鼠抗原的 PDB/CIF 文件及 `metadata.json`，并汇总 `dataset_summary.csv`、`processing_log.json`。
6. **格式转换**：可将 CIF 批量转换为 Boltz-1 YAML（`antibody-abtigen to-yaml`）。

## 目录概览
- 核心代码：`antibody_abtigen/`（CLI、pipeline、同源映射、结构处理、YAML 转换）。
- 入口脚本：`run.py`（方便 `uv run python run.py` 调用 CLI）。
- 辅助脚本：`scripts/run_full_pipeline.sh`（SLURM 提交）、`scripts/run_test.sh`（限量冒烟）。
- 数据与输出：`data/` 缓存下载；`output/` 结构与日志；`output_yamls/` YAML 转换结果。
- 文档与笔记：`docs/dev/`；本文件位于 `docs/outlines/`。

## 快速使用
- 环境与依赖：`uv sync`（如需 PyMOL 支持可 `uv sync --extra pymol` 并准备 `pymol-env`）。
- 冒烟（无下载）：`uv run python run.py --limit 10 --dry-run --no-pymol`。
- 小规模下载：`uv run antibody-abtigen build --limit 5 --no-pymol --output ./output --data-dir ./data`。
- YAML 转换：`uv run antibody-abtigen to-yaml --input ./output --output ./output_yamls`。

## 适用场景与注意事项
- 适合构建跨物种抗体-抗原配对数据，用于结构建模、比对或下游机器学习。
- 默认 CI 仅做 dry-run 以避免大量下载；本地或 HPC 跑全量时请预留网络与存储。
- 大型下载/生成文件请勿提交到 Git，确保 `.gitignore` 生效。
